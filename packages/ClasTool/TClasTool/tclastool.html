<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="CHANGEDBY" content="Maurik Holtrop">
   <meta name="GENERATOR" content="Mozilla/4.61 [en] (X11; I; Linux 2.2.5-15 i686) [Netscape]">
</head>
<body text="#FFFFFF" bgcolor="#00008A" link="#FFFF99" vlink="#FFCC00">

<center><b><font color="#FF99FF"><font size=+4>Root Analysis Framework</font></font></b>
<br><b><font color="#CC33CC"><font size=+4>TE2AnaTool</font></font></b>
<p><img SRC="blurulr4.gif" NAME="Graphic2" BORDER=0 height=12 width=100% align=BOTTOM></center>

<h2>
Index:</h2>

<blockquote><b><font size=+1><a href="#Introduction">Introduction</a></font></b>
<br><b><font size=+1><a href="#Comments on Writing Code">Comments on Writing
Code</a></font></b>
<br><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i><a href="http://www.physics.unh.edu/Maurik/CreatingCleanCode.shtml">Creating
Clean Code</a></i></b>
<br><b><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://www.physics.unh.edu/Maurik/CheckingInOnABranch.shtml">Checking
In On A Branch</a></i></b>
<br><b><font size=+1><a href="#Self Documenting Code">Self Documenting
Code</a></font></b>
<br><b><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="html/TE2AnaTool.html">Documentation
of the E2AnaTool Class</a></i></b>
<br><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <i>Documentation of the
e2banks classes </i><a href="html/e2banks_index.html">(server copy)</a></b><a href="html/e2banks_index.html">&nbsp;</a>
<b><a href="../e2banks/html/index.html">(local copy)</a></b>
<br><b><font size=+1><a href="#Additional ROOT information">Additional
Root Information</a></font></b>
<br><b><font size=+1><a href="#Compiling Libraries">Obtaining and Compiling
the Libraries</a></font></b>
<br><b><font size=+1><a href="#Using the Library">Using the Libraries</a></font></b></blockquote>

<center><img SRC="blurulr4.gif" NAME="Graphic2" BORDER=0 height=12 width=100% align=BOTTOM></center>

<h1>
<a NAME="Introduction"></a>Introduction</h1>
This Class has been developed to provide tools for the analyses of data
from the E2 run group (Jefferson Lab, CLAS) using a ROOT based framework.
E2 analyses data is stored in three basic formats BOS, PAW-Ntuple, and
ROOT tree. This package provides classes to read the ROOT trees and iterate
through them.
<h1>
<a NAME="Avalability"></a>Avalability</h1>
This package is now under the control of CVS at Jlabs. To retreive it you
need an account at Jlabs. If you do not have an account there, email <a href="mailto:gavalian@jlab.org">Gagik</a>
or <a href="mailto:maurik.holtrop@unh.edu">Maurik</a> for a 'tar' style
snapshot.
<p>To get the package look at the steps below. This will retreive the e2run/root
directory into the current directory. It contains all you need to compile
the code, however you need an installation of root to do so.
<br>NOTE: Package requires ROOT 2.22 or higher.
<h1>
<a NAME="Comments on Writing Code"></a>Comments on Writing Code</h1>
At the risk of being pedantic, I would like to ask everybody who plans
to modify the actual classes, to read the&nbsp; following documentation
on producing clean functional code. Thank you.
<blockquote><a href="http://www.physics.unh.edu/Maurik/CreatingCleanCode.shtml">Creating
Clean Code.</a> (by Maurik)</blockquote>
All changes must be checked in on a <i>BRANCH</i> first! See <i><a href="http://www.physics.unh.edu/Maurik/CheckingInOnABranch.shtml">CVS
Branches</a></i>.
<h1>
<a NAME="Self Documenting Code"></a>Self Documenting Code</h1>
Properly written code should be largely self documenting. The ROOT system
provides a mechanism to convert the C++ code into an html document describing
the functioning of the code (see <a href="http://root.cern.ch/root/html/THtml.html">THtml
class</a>). To generate a such a page for the E2AnaTool code, just type
'make docs'. The resulting html documents should appear in the 'html'&nbsp;
subdirectory, and can be found <a href="html/TE2AnaTool.html">here.</a>
Programmers, please read <a href="http://www.physics.unh.edu/Maurik/CreatingCleanCode.shtml">Creating
Clean Code</a> on how to comment your code such that the self documenting
feature works correctly.
<h1>
<a NAME="Additional ROOT information"></a>Additional ROOT information:</h1>
The following links may be helpful:
<blockquote>
<div STYLE="margin-left: 0.79in"><a href="http://root.cern.ch/">ROOT HOME
PAGE (get your root here)</a></div>
<a href="http://www-pat.fnal.gov/root/">Fermi LAB Tutorial</a></blockquote>

<center><img SRC="blurulr4.gif" NAME="Graphic1" BORDER=0 height=12 width=100% align=BOTTOM></center>

<h1>
<a NAME="Compiling Libraries"></a>Compiling Libraries</h1>
To compile package, follow these steps.
<br>&nbsp;
<ul>
<li>
set enviromental variable CVSROOT, TOP_DIR and OS_NAME.</li>

<li>
get the package using CVS</li>

<li>
make sure that you have ROOT installed and ROOTSYS variable points to ROOT
directory.</li>

<li>
enter to directory containing Makefile</li>

<li>
do make</li>
</ul>
From Prompt:
<p><b><u>Step 1:</u></b> Define Enviromental Variables:
<br>(the example below is given in tcsh)
<blockquote>Set the CVSROOT environment variable and check out package.
<br><font color="#FFCC00">home> setenv CVSROOT :pserver:user@jlabs1.cebaf.gov:/group/clas/clas_cvs</font>
<br>(Ofcource 'user' is your user name at Jlabs.)
<br><font color="#FFCC00">home> cvs login</font>
<br>password (same password as your account at Jlabs)
<br><font color="#FFCC00">home> cvs co e2run/root</font>
<br>(If you ommit the last 5 characters, /root, you also get all the kumacs
and such!)
<br><font color="#FFCC00">home> cd e2run</font>
<br>Set enviroment TOP_DIR to point to new created directory
<br><font color="#FFCC00">e2run> setenv TOP_DIR ~/e2run</font>
<br>(Alternatively you could use '~' or '$HOME' or any other TOP_DIR)<br>
Set OS_NAME to operatin system name you are running (Linux for example)
<br><font color="#FFCC00">home> setenv OS_NAME Linux</font>
<br>Check if you have ROOTSYS enviromental variable defined. If not, contact
your system administrator.
<br>Now You are ready to compile code.</blockquote>
<b><u>Step 2:</u></b> Compile.
<br>&nbsp;
<blockquote><font color="#FFCC00">e2run> cd root</font>
<br><font color="#FFCC00">e2run/root> make</font>
<br>After make is finished you must have two shared libraries in directory
$TOP_DIR/slib/$(OS_NAME):
<br>libROOTBanks.so
<br>libTE2AnaTool.so</blockquote>
Now you can run root and check if script load_libs.C successfully loads
libraries.
<br>If so, run example1.C and example2.C scripts provided with package
and enjoy displayed histograms.
<br>Next section contains example codes with explanations.
<p><img SRC="blurulr4.gif" NAME="Graphic1" BORDER=0 height=12 width=100% align=BOTTOM>
<h1>
<a NAME="Using the Library"></a><b>Using the Library</b></h1>
(This section of this document could use a good update using more functional
examples. In general, it is probably best to go and examine some of the
example code now.)
<p>After you have successfuly loaded libraries you can run simple codes
to se if it works.
<br>Here is a simple example with coments:
<p><u>Example 1</u>
<p><i>{</i>
<br><i>gROOT->Reset();</i>
<br><b>//</b>
<br><b>// Create istogram to display number of protons</b>
<br><b>//</b>
<br><i>TH1F *n_proton&nbsp;&nbsp; = new TH1F("n_proton","number of protons",7,-0.5,6.5);</i>
<br><i>TE2AnaTool *new_anal = new TE2AnaTool();</i>
<br><i>new_anal->AddFile("/scratch/data/run18449.A02.root");
</i><b>//
Add file to chain that will be analysed</b>
<br><i>new_anal->SetBeamEnergy(4.46);</i><b>// Set beam energy</b>
<br><b><i>//</i></b>
<br><b><i>// new_anal->GetChainEntries("EVENT") returns number of events
in EVENT tree</i></b>
<br><b><i>//&nbsp; in the chain.</i></b>
<br><b><i>//</i></b>
<br><i>for(int j = 0; j &lt; new_anal->GetChainEntries("EVENT"); j++){</i>
<br><i>; new_anal->Next();
</i><b>// Read Next Event from the Tree</b>
<br><i>; int n_prot = new_anal->GetNPartID(2212); </i><b>// function returns
number of particles</b>
<br><b>// with given ID (protons in particular)</b>
<br><b>&nbsp; </b><i>n_proton->Fill(n_prot);</i><b>// Fill Histogram with
number of protons</b>
<br><i>&nbsp;&nbsp;&nbsp; if(GetNRows("EVNT") > 2){&nbsp; </i><b>// GetNRows("EVNT")
returns number of rows in EVNT Bank</b>
<br><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cout &lt;&lt; "This event contains
" &lt;&lt; new_anal->GetNRows("EVNT") &lt;&lt; " particles" &lt;&lt; endl;</i>
<br><i>&nbsp;&nbsp;&nbsp; }</i>
<br><i>}}</i>
<p><img SRC="blurulr4.gif" NAME="Graphic1" BORDER=0 height=12 width=100% align=BOTTOM>
<p>Here is a little more complicated example.
<br>Program fills W and Q2 histograms for 2 proton events. Also fills histograms
with angular distribution for 1 proton events.
<br>&nbsp;
<p><u>Example 2</u>
<p><i>{</i>
<p><i>gROOT->Reset();</i>
<p><b>//</b>
<br><b>// Creating Histograms</b>
<br><b>//</b>
<br><i>TH1F *w_spec&nbsp;&nbsp;&nbsp; = new TH1F("w_spec", " w spectra",100,0.5,2.5);</i>
<br><i>TH1F *q2_spec&nbsp;&nbsp; = new TH1F("q2_spec"," q2 spectra",100,0.,2.5);</i>
<br><i>TH1F *prot_th = new TH1F("prot_th","Protons Th angle",180,0.,180.);</i>
<br>&nbsp;
<p><i>TE2AnaTool E2Anal= new TE2AnaTool();</i>
<br><i>E2Anal->AddFile("/scratch/data/run18449.A02.root");</i>
<br>&nbsp;
<p><i>for(int j = 0; j &lt; new_anal->GetChainEntries("EVENT"); j++){</i>
<br><b>//</b>
<br><b>// Analysing 1 proton Events</b>
<br><b>//</b>
<br><i>if(E2Anal->GetNPartID(2212) == 1){</i>
<br><i>&nbsp;&nbsp;&nbsp; for(int npart = 0; npart &lt; E2Anal->GetNRows("ENVT");
npart++){</i>
<br><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TEVNTClass *part_p = (TEVNTClass
*) E2Anal->GetBankRow("EVNT",npart);</i>
<br><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(part_p->Id == 2212){</i>
<br><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
float p_phi, p_th;</i>
<br><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
E2Anal->GetAngles(npart,&amp;p_phi,&amp;p_th);</i>
<br><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
prot_th->Fill(p_th);</i>
<br><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</i>
<br><i>&nbsp;&nbsp;&nbsp; }</i>
<br><i>}</i>
<p><b>//</b>
<br><b>//&nbsp; Analysing 2 proton Events</b>
<br><b>//</b>
<br><i>if(E2Anal->GetNPartID(2212) == 2){</i>
<br><i>&nbsp;&nbsp; float Q2, W2;</i>
<br><i>&nbsp;&nbsp;&nbsp; E2Anal->GetInvariants(&amp;Q2,&amp;W2);</i>
<br><i>&nbsp;&nbsp;&nbsp; q2_spec->Fill(Q2);</i>
<br><i>&nbsp;&nbsp;&nbsp;&nbsp; if(W2>=0) w_spec->Fill(sqrt(W2));</i>
<br><i>}}</i>
<br><img SRC="blurulr4.gif" NAME="Graphic1" BORDER=0 height=12 width=100% align=BOTTOM>
<br>&nbsp;
</body>
</html>
